
<div id="canvas4"></div>
<script>
    var app4 = new PIXI.Application(1024 / 2, 768 / 2, {backgroundColor : 0x0c243c});
    document.getElementById('canvas4').appendChild(app4.view);

    let starTexture = PIXI.Texture.fromImage('/Fatina/pixi/star.png')
    let emitter = { x: app4.renderer.width / 2, y: app4.renderer.height / 2 };

    let counter = 0;
    let delta = 0;
    let move = Fatina.tween(emitter)
        .from({x: app4.renderer.width / 2 - 200})
        .to({x: app4.renderer.width / 2 + 200}, 5000)
        .onUpdate((dt, progress) => {
            delta += dt;
            if (delta < 700) {
                return;
            }
            delta -= 700;
            StartAnim(emitter);
        })
        .setLoop(-1)
        .start();

    function StartAnim(emit) {
        let destX = emit.x;
        let destY = emit.y;
        let multi = counter % 2 === 0 ? - 1 : 1;
        counter ++;

        let prestar = new PIXI.Sprite(starTexture);
        prestar.anchor.set(0.5);
        prestar.scale.x = 0.2;
        prestar.scale.y = 0.2;
        prestar.x = destX;
        prestar.y = destY + multi * 200;
        prestar.rotation = multi * 12;
        prestar.alpha = 1;
        prestar.tint = 0xf4ee42;

        app4.stage.addChild(prestar);

        let tween = Fatina.tween(prestar)
            .to({ x: destX, y: destY, rotation: 0}, 900)
            .setEasing('outQuad')
            .onUpdate((dt, progress) => tween.modify({ x: 5 - progress * 5 }, false))
            .onComplete(function() {
                for (let i=0; i<20; i++) {
                    CreateStar(multi, destX, destY);
                }

                setTimeout(() => prestar.destroy(), 50);
            })
            .start();
    }

    function CreateStar(multi, x, y) {
        let star = new PIXI.Sprite(starTexture);
        star.anchor.set(0.5);

        star.x = x;
        star.y = y;
        star.scale.x = 0.2;
        star.scale.y = 0.2;
        star.dy = 0;
        star.alpha = 0;
        star.tint = 0xf4ee42;

        let smoke = Fatina.tween(star)
            .setRelative(true)
            .to({ x: Math.random() * 300 - 150, y: multi * (Math.random() * 200 + 200), rotation: Math.random() * 12 - 6}, 1600)
            .onUpdate((dt) => {
                star.dy -= multi * dt / 100;
                smoke.modify({y: star.dy}, true)
            })
            .onComplete(() => star.destroy());

        let fadeIn = Fatina.tween(star).to({ alpha: Math.random() * 0.4 + 0.6 }, 250);
        let fadeOut = Fatina.tween(star).to({ alpha: 0 }, 950).setEasing('outSine');

        let sequence = Fatina.sequence()
            .append(fadeIn)
            .appendInterval(4050)
            .append(fadeOut)
            .join(smoke)
            .start();

        app4.stage.addChild(star);
    }
</script>