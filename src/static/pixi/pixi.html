<div id="canvas1"></div>
<script>
  document.addEventListener('DOMContentLoaded', () => {
    var app = new PIXI.Application(1024 / 2, 768 / 2, {backgroundColor : 0x1099bb});
    document.getElementById('canvas1').appendChild(app.view);

    // Create background with parallax
    CreateBackgrounds();

    // Create unity chan
    let textures = LoadUnityChanTextures();

    var unitychan = new PIXI.Sprite(textures[0]);
    unitychan.anchor.set(0.5);
    unitychan.scale.x = 1.5;
    unitychan.scale.y = 1.5;
    unitychan.x = app.renderer.width / 4;
    unitychan.y = app.renderer.height - 78;
    app.stage.addChild(unitychan);

    // Tween to update unity chan sprite
    Fatina.tween({})
    .to({}, 1800)
    .onUpdate((dt, progress) => {
        let index = Math.round(progress * (textures.length - 1));
        unitychan.setTexture(textures[index]);
    })
    .setLoop(-1)
    .start();

    // Tween to update unity chan position
    Fatina.sequence()
        .append(Fatina.tween(unitychan).setRelative(true).to({ x : -20}, 3000).setEasing('outQuad'))
        .append(Fatina.tween(unitychan).setRelative(true).to({ x : 40}, 3000).setEasing('inOutQuad'))
        .append(Fatina.tween(unitychan).setRelative(true).to({ x : -20}, 3000).setEasing('inQuad'))
        .setLoop(-1)
        .start();


    function CreateBackgrounds() {
        // create a new Sprite from an image path
        var layerSky = new PIXI.Container();
        var layerMountain = new PIXI.Container();
        var layerMountain2 = new PIXI.Container();
        var layerFront = new PIXI.Container();

        // create a new Sprite from an image path
        AddSprite('/Fatina/pixi/clouds.png', layerSky, app.renderer.width / 2, app.renderer.height / 2 - 20, 1);
        AddSprite('/Fatina/pixi/clouds.png', layerSky, app.renderer.width + app.renderer.width / 2, app.renderer.height / 2 - 20, 1);
        AddSprite('/Fatina/pixi/mountains.png', layerMountain2, app.renderer.width / 2, app.renderer.height / 2, 1);
        AddSprite('/Fatina/pixi/mountains.png', layerMountain2, app.renderer.width + app.renderer.width / 2, app.renderer.height / 2, 1);
        AddSprite('/Fatina/pixi/mountains.png', layerMountain, app.renderer.width / 2, app.renderer.height / 2 + 30, 1);
        AddSprite('/Fatina/pixi/mountains.png', layerMountain, app.renderer.width + app.renderer.width / 2, app.renderer.height / 2 + 30, 1);
        AddSprite('/Fatina/pixi/ground.png', layerFront, app.renderer.width / 2, app.renderer.height / 2, 1);
        AddSprite('/Fatina/pixi/ground.png', layerFront, app.renderer.width + app.renderer.width / 2, app.renderer.height / 2, 1);

        // Move horizontaly each layer at different speed
        AutoMove(layerSky, 90000);
        AutoMove(layerMountain2, 35000);
        AutoMove(layerMountain, 18000);
        AutoMove(layerFront, 6000);

        // Apply a vertical sin on the cloud
        Fatina.sequence()
            .append(Fatina.tween(layerSky).setRelative(true).to({ y : -10}, 5000).setEasing('outSine'))
            .append(Fatina.tween(layerSky).setRelative(true).to({ y : 20}, 10000).setEasing('inOutSine'))
            .append(Fatina.tween(layerSky).setRelative(true).to({ y : -10}, 5000).setEasing('inSine'))
            .setLoop(-1)
            .start();

        // Add to stage
        app.stage.addChild(layerSky);
        app.stage.addChild(layerMountain2);
        app.stage.addChild(layerMountain);
        app.stage.addChild(layerFront);
    }

    function AddSprite(path, container, x, y, scale) {
            var img = PIXI.Sprite.fromImage(path);
            img.anchor.set(0.5);
            img.x = x;
            img.y = y;
            img.scale.x = scale;
            img.scale.y = scale;
            container.addChild(img);
            return img;
    }

    function AutoMove(container, duration) {
        Fatina.tween(container)
            .from({x: 0})
            .to({x: -app.renderer.width }, duration)
            .setLoop(-1)
            .start();
    }

    function LoadUnityChanTextures() {
        let textures = [];
        for (let i = 1; i < 19; i++) {
            textures.push(PIXI.Texture.fromImage('/Fatina/pixi/run/Unitychan_Run_' + i + '.png'));
        }
        return textures;
    }
  })
</script>
