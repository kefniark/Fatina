<style>
    .imgTest {
        position: relative;
    }

    hr {
        border-top: 1px dashed #8c8b8b;
        border-bottom: 1px dashed #fff;
        margin-top: 25px !important;
        clear: both;
    }

    .testresult {
        text-align: center;
    }

    .best {
        background-color: lightgreen;
        font-weight: bold;
    }

    .worst {
        background-color: lightcoral;
    }

    .normal {
        background-color: lightyellow;
    }

    .crash {
        background-color: black;
        color: lightgray;
        font-weight: bold;
    }
</style>

<script src="/Fatina/benchmark/tina.min.js"></script>
<script src="/Fatina/benchmark/tweenjs-0.6.2.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tween.js/16.3.5/Tween.min.js"></script>


<div style="display: none; height: 5px; position: absolute;">
    <h2>Fatina</h2>

    <h3>Normal Tween</h3>
    <div class="row">
        <div class="col-md-2">
            <button class="btn test" onclick="Test('Fatina Normal', 'fatina1', TestFatina, TestFatinaUpdate, 200, 100, 50);">50x 200 tweens</button>
            <div class="fatina1"></div>
        </div>
        <div class="col-md-2">
            <button class="btn test" onclick="Test('Fatina Normal', 'fatina2', TestFatina, TestFatinaUpdate, 5000, 100, 10);">10x 5k tweens</button>
            <div class="fatina2"></div>
        </div>
        <div class="col-md-2">
            <button class="btn test" onclick="Test('Fatina Normal', 'fatina3', TestFatina, TestFatinaUpdate, 10000, 100, 10);">5x 20k tweens</button>
            <div class="fatina3"></div>
        </div>
        <div class="col-md-2">
            <button class="btn test" onclick="Test('Fatina Normal', 'fatina4', TestFatina, TestFatinaUpdate, 1000, 500, 100);">100x 1000 tweens</button>
            <div class="fatina4"></div>
        </div>
    </div>

    <h3>Complicated Tween</h3>
    <div class="row">
        <div class="col-md-2">
            <button class="btn test" onclick="Test('Fatina Advanced', 'fatina10', TestFatinaAdvanced, TestFatinaUpdate, 200, 100, 50);">50x 200 tweens</button>
            <div class="fatina10"></div>
        </div>
        <div class="col-md-2">
            <button class="btn test" onclick="Test('Fatina Advanced', 'fatina11', TestFatinaAdvanced, TestFatinaUpdate, 5000, 100, 10);">10x 5k tweens</button>
            <div class="fatina11"></div>
        </div>
        <div class="col-md-2">
            <button class="btn test" onclick="Test('Fatina Advanced', 'fatina12', TestFatinaAdvanced, TestFatinaUpdate, 10000, 100, 10);">5x 20k tweens</button>
            <div class="fatina12"></div>
        </div>
        <div class="col-md-2">
            <button class="btn test" onclick="Test('Fatina Advanced', 'fatina13', TestFatinaAdvanced, TestFatinaUpdate, 1000, 500, 200);">200x 1000 tweens</button>
            <div class="fatina13"></div>
        </div>
    </div>

    <h3>Sequence</h3>
    <div class="row">
        <div class="col-md-2">
            <button class="btn test" onclick="Test('Fatina Sequence', 'fatina20', TestFatinaSequence, TestFatinaUpdate, 200, 100, 50);">50x 200 tweens</button>
            <div class="fatina20"></div>
        </div>
        <div class="col-md-2">
            <button class="btn test" onclick="Test('Fatina Sequence', 'fatina21', TestFatinaSequence, TestFatinaUpdate, 5000, 100, 10);">10x 5k tweens</button>
            <div class="fatina21"></div>
        </div>
        <div class="col-md-2">
            <button class="btn test" onclick="Test('Fatina Sequence', 'fatina22', TestFatinaSequence, TestFatinaUpdate, 10000, 100, 10);">5x 20k tweens</button>
            <div class="fatina22"></div>
        </div>
        <div class="col-md-2">
            <button class="btn test" onclick="Test('Fatina Sequence', 'fatina23', TestFatinaSequence, TestFatinaUpdate, 1000, 500, 200);">200x 1000 tweens</button>
            <div class="fatina23"></div>
        </div>
    </div>

    <hr/>

    <h2>TINA</h2>

    <h3>Normal Tween</h3>
    <div class="row">
        <div class="col-md-2">
            <button class="btn test" onclick="Test('Tina Normal', 'tina1', Tina, TinaUpdate, 200, 100, 50);">50x 200 tweens</button>
            <div class="tina1"></div>
        </div>
        <div class="col-md-2">
            <button class="btn test" onclick="Test('Tina Normal', 'tina2', Tina, TinaUpdate, 5000, 100, 10);">10x 5k tweens</button>
            <div class="tina2"></div>
        </div>
        <div class="col-md-2">
            <button class="btn test" onclick="Test('Tina Normal', 'tina3', Tina, TinaUpdate, 10000, 100, 10);">5x 20k tweens</button>
            <div class="tina3"></div>
        </div>
        <div class="col-md-2">
            <button class="btn test" onclick="Test('Tina Normal', 'tina4', Tina, TinaUpdate, 1000, 500, 100);">100x 1000 tweens</button>
            <div class="tina4"></div>
        </div>
    </div>

    <h3>Complicated Tween</h3>
    <div class="row">
        <div class="col-md-2">
            <button class="btn test" onclick="Test('Tina Advanced', 'tina10', TinaAdvanced, TinaUpdate, 200, 100, 50);">50x 200 tweens</button>
            <div class="tina10"></div>
        </div>
        <div class="col-md-2">
            <button class="btn test" onclick="Test('Tina Advanced', 'tina11', TinaAdvanced, TinaUpdate, 5000, 100, 10);">10x 5k tweens</button>
            <div class="tina11"></div>
        </div>
        <div class="col-md-2">
            <button class="btn test" onclick="Test('Tina Advanced', 'tina12', TinaAdvanced, TinaUpdate, 10000, 100, 10);">5x 20k tweens</button>
            <div class="tina12"></div>
        </div>
        <div class="col-md-2">
            <button class="btn test" onclick="Test('Tina Advanced', 'tina13', TinaAdvanced, TinaUpdate, 1000, 500, 200);">200x 1000 tweens</button>
            <div class="tina13"></div>
        </div>
    </div>

    <h3>Sequence</h3>
    <div class="row">
        <div class="col-md-2">
            <button class="btn test" onclick="Test('Tina Sequence', 'tina20', TinaSequence, TinaUpdate, 200, 100, 50);">50x 200 tweens</button>
            <div class="tina20"></div>
        </div>
        <div class="col-md-2">
            <button class="btn test" onclick="Test('Tina Sequence', 'tina21', TinaSequence, TinaUpdate, 5000, 100, 10);">10x 5k tweens</button>
            <div class="tina21"></div>
        </div>
        <div class="col-md-2">
            <button class="btn test" onclick="Test('Tina Sequence', 'tina22', TinaSequence, TinaUpdate, 10000, 100, 10);">5x 20k tweens</button>
            <div class="tina22"></div>
        </div>
        <div class="col-md-2">
            <button class="btn test" onclick="Test('Tina Sequence', 'tina23', TinaSequence, TinaUpdate, 1000, 500, 200);">200x 1000 tweens</button>
            <div class="tina23"></div>
        </div>
    </div>

    <hr/>
    <h2>Tween.js</h2>

    <h3>Normal Tween</h3>
    <div class="row">
        <div class="col-md-2">
            <button class="btn test" onclick="Test('Tween.js Normal', 'tween1', TestTween, TestTweenUpdate, 200, 100, 50);">50x 200 tweens</button>
            <div class="tween1"></div>
        </div>
        <div class="col-md-2">
            <button class="btn test" onclick="Test('Tween.js Normal', 'tween2', TestTween, TestTweenUpdate, 5000, 100, 10);">10x 5k tweens</button>
            <div class="tween2"></div>
        </div>
        <div class="col-md-2">
            <button class="btn test" onclick="Test('Tween.js Normal', 'tween3', TestTween, TestTweenUpdate, 10000, 100, 10);">5x 20k tweens</button>
            <div class="tween3"></div>
        </div>
        <div class="col-md-2">
            <button class="btn test" onclick="Test('Tween.js Normal', 'tween4', TestTween, TestTweenUpdate, 1000, 500, 200);">100x 1000 tweens</button>
            <div class="tween4"></div>
        </div>
    </div>

    <h3>Complicated Tween</h3>
    <div class="row">
        <div class="col-md-2">
            <button class="btn test" onclick="Test('Tween.js Advanced', 'tween10', TestTweenAdvanced, TestTweenUpdate, 200, 100, 50);">50x 200 tweens</button>
            <div class="tween10"></div>
        </div>
        <div class="col-md-2">
            <button class="btn test" onclick="Test('Tween.js Advanced', 'tween11', TestTweenAdvanced, TestTweenUpdate, 5000, 100, 10);">10x 5k tweens</button>
            <div class="tween11"></div>
        </div>
        <div class="col-md-2">
            <button class="btn test" onclick="Test('Tween.js Advanced', 'tween12', TestTweenAdvanced, TestTweenUpdate, 10000, 100, 10);">5x 20k tweens</button>
            <div class="tween12"></div>
        </div>
        <div class="col-md-2">
            <button class="btn test" onclick="Test('Tween.js Advanced', 'tween13', TestTweenAdvanced, TestTweenUpdate, 1000, 500, 200);">200x 1000 tweens</button>
            <div class="tween13"></div>
        </div>
    </div>

    <h3>Sequence</h3>
    <div class="row">
        <div class="col-md-2">
            <button class="btn test" onclick="Test('Tween.js Sequence', 'tween20', TestTweenSequence, TestTweenUpdate, 200, 100, 50);">50x 200 tweens</button>
            <div class="tween20"></div>
        </div>
        <div class="col-md-2">
            <button class="btn test" onclick="Test('Tween.js Sequence', 'tween21', TestTweenSequence, TestTweenUpdate, 5000, 100, 10);">10x 5k tweens</button>
            <div class="tween21"></div>
        </div>
        <div class="col-md-2">
            <button class="btn test" onclick="Test('Tween.js Sequence', 'tween22', TestTweenSequence, TestTweenUpdate, 10000, 100, 10);">5x 20k tweens</button>
            <div class="tween22"></div>
        </div>
        <div class="col-md-2">
            <button class="btn test" onclick="Test('Tween.js Sequence', 'tween23', TestTweenSequence, TestTweenUpdate, 1000, 500, 200);">200x 1000 tweens</button>
            <div class="tween23"></div>
        </div>
    </div>

    <script>
        function TestFatinaUpdate() {
            Fatina.Update(1);
        }

        function TestFatina() {
            return Fatina.Tween({x:0}, ['x']).To({x:100}, 10).Start();
        }

        function TestFatinaAdvanced() {
            return Fatina.Tween({x:0, y:0, z:0, a:0}, ['x', 'y', 'z', 'a'])
                .To({x:100, y:2, z:69, a:-71602}, Math.random() * 5 + 10)
                .SetLoop(2)
                .SetEasing('inOutQuad')
                .OnStart(() => {})
                .OnComplete(() => {})
                .Start();
        }

        function TestFatinaSequence() {
            Fatina.Sequence()
                .Append(Fatina.Tween({x:0}, ['x']).To({x: 2}, 2))
                .AppendInterval(1)
                .Append(Fatina.Tween({x:0}, ['x']).To({x: 5}, 3))
                .Start();
        }
    </script>

    <script>
        function TinaUpdate() {
            TINA.update();
        }

        function Tina() {
            return TINA.Tween({x:0}, ['x']).to({x:100}, 10).start();
        }

        function TinaAdvanced() {
                return TINA.Tween({x:0, y:0, z:0, a:0}, ['x', 'y', 'z', 'a'])
                .to({x:100, y:2, z:69, a:-71602}, Math.random() * 5 + 10, TINA.easing.quadInOut)
                .iterations(2)
                .onStart(() => {})
                .onComplete(() => {})
                .start();
        }

        function TinaSequence() {
            new TINA.Sequence()
                .add(TINA.Tween({x:0}, ['x']).to({x:2}, 2))
                .addDelay(1)
                .add(TINA.Tween({x:0}, ['x']).to({x:5}, 3))
                .start();
        }
    </script>

    <script>
        function TestTweenUpdate() {
            TWEEN.update();
        }

        function TestTween() {
            return new TWEEN.Tween({x:0}, ['x']).to({x:100}, 10).start();
        }

        function TestTweenAdvanced() {
            return new TWEEN.Tween({x:0, y:0, z:0, a:0}, ['x', 'y', 'z', 'a'])
                .to({x:100, y:2, z:69, a:-71602}, Math.random() * 5 + 10)
                .easing(TWEEN.Easing.Quadratic.InOut)
                .repeat(2)
                .onStart(() => {})
                .onComplete(() => {})
                .start();
        }

        function TestTweenSequence() {
            let tweenA = new TWEEN.Tween({x:0}, ['x']).to({x:2}, 2);
            let tweenB = new TWEEN.Tween({x:0}, ['x']).to({x:5}, 3).delay(1);
            tweenA.chain(tweenB);
            tweenA.start();
        }
    </script>

    <script>
        // default fatina setup
        Fatina.Init(true);
        Fatina.SetSafe(false);

        // default tina setup
        let tinaTimer = new TINA.Timer().useAsDefault();
        TINA.add(tinaTimer);


        let counter = document.getElementById('counter');
        let counterValue = 0;
        let test = document.getElementsByClassName('test');
        function RunAll() {
            let buttons = document.getElementsByClassName('test');
            buttons = [].slice.call(buttons);
            RunTest(buttons);
        }

        function RunTest(buttons) {
            if (buttons.length === 0) {
                return;
            }

            let button = buttons.shift();
            button.onclick();

            // cooldown between 2 tests (execute bunch of updates)
            setTimeout(() => {
                for (let i = 0; i < 20; i++) {
                    TestFatinaUpdate();
                    TinaUpdate();
                    TestTweenUpdate();
                }
            }, 50);
            setTimeout(() => RunTest(buttons), 300);
        }

        function Test(name, spanResult, method, update, totalTween, frameNumber, iterate) {
            let timeStart = Date.now();
            console.log("Run:");
            console.log(" * " + name + ": with " + totalTween + " tweens updated over " + frameNumber + " frames");
            for (let i = 0; i < iterate; i++) {
                TestExec(method, update, totalTween, frameNumber);
            }

            let result = Date.now() - timeStart;
            let average = result / iterate;
            let averageByFrame = average / frameNumber;
            console.log(" * Result: elapsed time : " + result + 'ms. , average: ' + average + 'ms. (' + averageByFrame + 'ms./frame)');

            counter.innerHTML = Math.round(counterValue / 1000);

            let results = document.getElementsByClassName(spanResult);
            results = [].slice.call(results);
            for (let elem of results) {
                elem.innerHTML =  average + 'ms.';
                elem.duration = average;

                let parent = elem.parentElement.parentElement;
                if (parent.nodeName === 'TR') {
                    let elems = [].slice.call(parent.getElementsByClassName('testresult'));
                    let durations = elems.map(x => x.duration).filter(x => x !== undefined);
                    let min = 10000;
                    let max = 0;

                    for (let dur of durations) {
                        min = min > dur ? dur : min;
                        max = max < dur ? dur : max;
                    }

                    for (let elem of elems) {
                        elem.parentElement.classList.remove("best");
                        elem.parentElement.classList.remove("worst");
                        elem.parentElement.classList.remove("normal");
                        if (elem.duration === min) {
                            elem.parentElement.classList.add("best");
                        } else if (elem.duration === max) {
                            elem.parentElement.classList.add("worst");
                        } else {
                            elem.parentElement.classList.add("normal");
                        }
                    }
                }
            }
        }

        function TestExec(method, update, totalTween, frameNumber) {
            let timeStart = Date.now();
            for (let frame = 0; frame < frameNumber; frame++) {
                if (frame < frameNumber/2) {
                    for (let i = 0; i < totalTween / (frameNumber / 2); i++) {
                        method();
                        counterValue++;
                    }
                }

                update();
            }
        }
    </script>
</div>